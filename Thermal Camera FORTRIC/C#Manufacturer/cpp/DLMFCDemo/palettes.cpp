#include "stdafx.h"
#include "palettes.h"

void
convertRawToBGR(const RawValue * value_buf,int width,int height,BYTE * bgr_buf, uint8_t palette[256][3])
{
	
	RawValue smin = 65535,smax = 0;

	/** 全辐射流的图像是16位的高动态图像，先将图像的每个像素压缩到8位
	    最简单的方法是找到图像上的最大和最小值	**/
	for(int i = 0;i< width * height;i++)
	{
		if(smin > value_buf[i])
			smin = value_buf[i];
		if(smax < value_buf[i])
			smax = value_buf[i];
	}

	int span = smax - smin;

	/** 除数不能为零 **/
	if(span < 1)
		span = 1;

	for(int i = 0;i < height;i++)
	{
		const RawValue * psrc = value_buf + i * width;
		BYTE * prow = bgr_buf + i * width * 3;

		for(int j = 0;j < width;j++)
		{
			/** 8位数值作为调色板的索引 **/
			int idx =  (psrc[j] - smin) * 255 / span;
			//assert(idx >=0 && idx < 256);
			prow[j * 3] = palette[idx][2];
			prow[j * 3 + 1] = palette[idx][1];
			prow[j * 3 + 2] = palette[idx][0];
		}
	}
}

uint8_t Grey[256][3] = 
{
	{0,0,0},
	{1,1,1},
	{2,2,2},
	{3,3,3},
	{4,4,4},
	{5,5,5},
	{6,6,6},
	{7,7,7},
	{8,8,8},
	{9,9,9},
	{10,10,10},
	{11,11,11},
	{12,12,12},
	{13,13,13},
	{14,14,14},
	{15,15,15},
	{16,16,16},
	{17,17,17},
	{18,18,18},
	{19,19,19},
	{20,20,20},
	{21,21,21},
	{22,22,22},
	{23,23,23},
	{24,24,24},
	{25,25,25},
	{26,26,26},
	{27,27,27},
	{28,28,28},
	{29,29,29},
	{30,30,30},
	{31,31,31},
	{32,32,32},
	{33,33,33},
	{34,34,34},
	{35,35,35},
	{36,36,36},
	{37,37,37},
	{38,38,38},
	{39,39,39},
	{40,40,40},
	{41,41,41},
	{42,42,42},
	{43,43,43},
	{44,44,44},
	{45,45,45},
	{46,46,46},
	{47,47,47},
	{48,48,48},
	{49,49,49},
	{50,50,50},
	{51,51,51},
	{52,52,52},
	{53,53,53},
	{54,54,54},
	{55,55,55},
	{56,56,56},
	{57,57,57},
	{58,58,58},
	{59,59,59},
	{60,60,60},
	{61,61,61},
	{62,62,62},
	{63,63,63},
	{64,64,64},
	{65,65,65},
	{66,66,66},
	{67,67,67},
	{68,68,68},
	{69,69,69},
	{70,70,70},
	{71,71,71},
	{72,72,72},
	{73,73,73},
	{74,74,74},
	{75,75,75},
	{76,76,76},
	{77,77,77},
	{78,78,78},
	{79,79,79},
	{80,80,80},
	{81,81,81},
	{82,82,82},
	{83,83,83},
	{84,84,84},
	{85,85,85},
	{86,86,86},
	{87,87,87},
	{88,88,88},
	{89,89,89},
	{90,90,90},
	{91,91,91},
	{92,92,92},
	{93,93,93},
	{94,94,94},
	{95,95,95},
	{96,96,96},
    {97,97,97},
	{98,98,98},
	{99,99,99},
	{100,100,100},
	{101,101,101},
	{102,102,102},
	{103,103,103},
	{104,104,104},
	{105,105,105},
	{106,106,106},
	{107,107,107},
	{108,108,108},
	{109,109,109},
	{110,110,110},
	{111,111,111},
	{112,112,112},
	{113,113,113},
	{114,114,114},
	{115,115,115},
	{116,116,116},
	{117,117,117},
	{118,118,118},
	{119,119,119},
	{120,120,120},
	{121,121,121},
	{122,122,122},
	{123,123,123},
	{124,124,124},
	{125,125,125},
	{126,126,126},
	{127,127,127},
	{128,128,128},
	{129,129,129},
	{130,130,130},
	{131,131,131},
	{132,132,132},
	{133,133,133},
	{134,134,134},
	{135,135,135},
	{136,136,136},
	{137,137,137},
	{138,138,138},
	{139,139,139},
	{140,140,140},
	{141,141,141},
	{142,142,142},
	{143,143,143},
	{144,144,144},
	{145,145,145},
	{146,146,146},
	{147,147,147},
	{148,148,148},
	{149,149,149},
	{150,150,150},
	{151,151,151},
	{152,152,152},
	{153,153,153},
	{154,154,154},
	{155,155,155},
	{156,156,156},
	{157,157,157},
	{158,158,158},
	{159,159,159},
	{160,160,160},
	{161,161,161},
	{162,162,162},
	{163,163,163},
	{164,164,164},
	{165,165,165},
	{166,166,166},
	{167,167,167},
	{168,168,168},
	{169,169,169},
	{170,170,170},
	{171,171,171},
	{172,172,172},
	{173,173,173},
	{174,174,174},
	{175,175,175},
	{176,176,176},
	{177,177,177},
	{178,178,178},
	{179,179,179},
	{180,180,180},
	{181,181,181},
	{182,182,182},
	{183,183,183},
	{184,184,184},
	{185,185,185},
	{186,186,186},
	{187,187,187},
	{188,188,188},
	{189,189,189},
	{190,190,190},
	{191,191,191},
	{192,192,192},
	{193,193,193},
	{194,194,194},
	{195,195,195},
	{196,196,196},
	{197,197,197},
	{198,198,198},
	{199,199,199},
	{200,200,200},
	{201,201,201},
	{202,202,202},
	{203,203,203},
	{204,204,204},
	{205,205,205},
	{206,206,206},
	{207,207,207},
	{208,208,208},
	{209,209,209},
	{210,210,210},
	{211,211,211},
	{212,212,212},
	{213,213,213},
	{214,214,214},
	{215,215,215},
	{216,216,216},
	{217,217,217},
	{218,218,218},
	{219,219,219},
	{220,220,220},
	{221,221,221},
	{222,222,222},
	{223,223,223},
	{224,224,224},
	{225,225,225},
	{226,226,226},
	{227,227,227},
	{228,228,228},
	{229,229,229},
	{230,230,230},
	{231,231,231},
	{232,232,232},
	{233,233,233},
	{234,234,234},
	{235,235,235},
	{236,236,236},
	{237,237,237},
	{238,238,238},
	{239,239,239},
	{240,240,240},
	{241,241,241},
	{242,242,242},
	{243,243,243},
	{244,244,244},
	{245,245,245},
	{246,246,246},
	{247,247,247},
	{248,248,248},
	{249,249,249},
	{250,250,250},
	{251,251,251},
	{252,252,252},
	{253,253,253},
	{254,254,254},
	{255,255,255}
};

uint8_t Iron[256][3] = 
{
	{0, 15, 20},
	{0, 14, 25},
	{0, 12, 31},
	{0, 11, 37},
	{0, 10, 43},
	{0, 9, 50},
	{0, 8, 56},
	{0, 7, 60},
	{0, 6, 66},
	{0, 5, 72},
	{0, 3, 75},
	{0, 3, 82},
	{2, 2, 85},
	{8, 0, 88},
	{10, 0, 95},
	{13, 0, 97},
	{18, 0, 102},
	{23, 0, 106},
	{25, 0, 109},
	{29, 0, 112},
	{33, 0, 119},
	{36, 0, 120},
	{40, 0, 123},
	{43, 0, 126},
	{47, 0, 130},
	{51, 0, 131},
	{54, 0, 134},
	{57, 0, 137},
	{60, 0, 138},
	{64, 0, 140},
	{67, 0, 143},
	{69, 0, 144},
	{74, 0, 145},
	{77, 0, 148},
	{79, 0, 149},
	{82, 0, 150},
	{86, 0, 151},
	{89, 0, 152},
	{92, 0, 155},
	{94, 0, 155},
	{96, 0, 156},
	{101, 0, 157},
	{103, 0, 159},
	{109, 0, 161},
	{113, 0, 160},
	{115, 0, 160},
	{118, 0, 161},
	{120, 0, 160},
	{123, 0, 162},
	{126, 0, 162},
	{128, 0, 161},
	{131, 0, 162},
	{132, 0, 160},
	{134, 0, 161},
	{138, 0, 162},
	{141, 0, 159},
	{144, 1, 160},
	{145, 2, 160},
	{149, 2, 159},
	{149, 5, 158},
	{150, 6, 155},
	{155, 6, 154},
	{156, 7, 153},
	{157, 8, 154},
	{161, 8, 154},
	{163, 10, 153},
	{164, 12, 150},
	{166, 13, 148},
	{169, 13, 149},
	{172, 14, 146},
	{172, 16, 147},
	{174, 17, 145},
	{177, 18, 144},
	{180, 19, 143},
	{179, 22, 138},
	{182, 23, 137},
	{183, 24, 134},
	{186, 24, 135},
	{189, 25, 133},
	{192, 26, 132},
	{193, 28, 129},
	{192, 31, 127},
	{197, 31, 124},
	{198, 33, 123},
	{198, 33, 119},
	{201, 35, 116},
	{200, 37, 117},
	{201, 38, 115},
	{206, 39, 112},
	{207, 40, 111},
	{208, 42, 108},
	{208, 45, 105},
	{210, 46, 102},
	{212, 48, 101},
	{213, 50, 99},
	{215, 51, 96},
	{215, 54, 93},
	{218, 54, 92},
	{219, 56, 89},
	{219, 59, 86},
	{220, 61, 85},
	{222, 62, 82},
	{222, 64, 80},
	{223, 66, 77},
	{226, 67, 76},
	{226, 70, 73},
	{227, 72, 70},
	{229, 73, 65},
	{229, 75, 66},
	{230, 77, 64},
	{231, 79, 61},
	{233, 81, 60},
	{234, 83, 57},
	{236, 84, 52},
	{238, 86, 49},
	{237, 89, 48},
	{237, 91, 47},
	{239, 92, 45},
	{239, 95, 42},
	{240, 97, 39},
	{241, 99, 36},
	{243, 100, 35},
	{244, 102, 32},
	{243, 105, 31},
	{244, 106, 31},
	{246, 108, 28},
	{245, 111, 25},
	{246, 113, 23},
	{248, 114, 22},
	{249, 116, 19},
	{248, 118, 20},
	{249, 120, 17},
	{249, 123, 17},
	{250, 125, 14},
	{250, 127, 13},
	{248, 127, 11},
	{249, 131, 9},
	{249, 131, 7},
	{248, 134, 6},
	{250, 135, 5},
	{250, 136, 1},
	{249, 138, 1},
	{249, 141, 0},
	{250, 142, 0},
	{249, 145, 0},
	{249, 147, 0},
	{250, 148, 0},
	{250, 150, 0},
	{249, 152, 0},
	{249, 154, 0},
	{250, 156, 0},
	{250, 158, 0},
	{249, 160, 0},
	{250, 163, 0},
	{249, 166, 0},
	{249, 170, 0},
	{250, 171, 0},
	{248, 173, 0},
	{249, 174, 0},
	{249, 176, 0},
	{248, 178, 0},
	{248, 180, 0},
	{249, 182, 0},
	{249, 184, 0},
	{250, 186, 0},
	{250, 187, 0},
	{249, 189, 0},
	{250, 191, 0},
	{250, 193, 1},
	{249, 195, 2},
	{249, 197, 3},
	{249, 199, 4},
	{250, 199, 8},
	{249, 201, 9},
	{249, 204, 8},
	{248, 205, 13},
	{250, 206, 14},
	{249, 208, 17},
	{249, 209, 21},
	{248, 212, 20},
	{249, 212, 23},
	{249, 214, 27},
	{250, 217, 29},
	{249, 218, 33},
	{249, 220, 36},
	{250, 221, 39},
	{250, 222, 42},
	{249, 224, 45},
	{249, 225, 49},
	{250, 226, 54},
	{249, 227, 57},
	{249, 229, 62},
	{249, 230, 65},
	{248, 231, 70},
	{249, 232, 76},
	{249, 233, 81},
	{250, 233, 86},
	{248, 236, 89},
	{248, 236, 96},
	{247, 238, 102},
	{247, 239, 107},
	{248, 239, 112},
	{247, 240, 117},
	{247, 241, 125},
	{247, 242, 131},
	{245, 244, 136},
	{246, 244, 141},
	{244, 246, 149},
	{243, 246, 157},
	{244, 247, 160},
	{242, 248, 169},
	{240, 250, 176},
	{242, 250, 185},
	{241, 250, 193},
	{241, 251, 202},
	{239, 251, 208},
	{239, 251, 217},
	{240, 251, 224},
	{238, 250, 235},
	{238, 251, 242},
	{236, 250, 248},
	{236, 250, 248},
	{236, 250, 248},
	{236, 250, 248},
	{236, 250, 248},
	{236, 250, 248},
	{236, 250, 248},
	{236, 250, 248},
	{236, 250, 248},
	{236, 250, 248},
	{236, 250, 248},
	{236, 250, 248},
	{236, 250, 248},
	{236, 250, 248},
	{236, 250, 248},
	{236, 250, 248},
	{236, 250, 248},
	{236, 250, 248},
	{236, 250, 248},
	{236, 250, 248},
	{236, 250, 248},
	{236, 250, 248},
	{236, 250, 248},
	{236, 250, 248},
	{236, 250, 248},
	{236, 250, 248},
	{236, 250, 248},
	{236, 250, 248},
	{236, 250, 248},
	{236, 250, 248},
	{236, 250, 248},
	{236, 250, 248},
	{236, 250, 248},
	{236, 250, 248},
	{236, 250, 248},
	{236, 250, 248}
};

uint8_t Rainbow[256][3] = 
{
	{0, 0, 0},
	{1, 0, 0},
	{5, 0, 6},
	{15, 0, 12},
	{25, 0, 23},
	{31, 0, 30},
	{42, 0, 42},
	{49, 0, 45},
	{57, 0, 56},
	{68, 0, 63},
	{72, 0, 75},
	{83, 0, 81},
	{90, 0, 92},
	{100, 0, 96},
	{109, 0, 109},
	{119, 0, 118},
	{126, 0, 126},
	{135, 0, 134},
	{145, 0, 142},
	{153, 0, 149},
	{159, 0, 156},
	{169, 0, 167},
	{177, 0, 175},
	{186, 0, 186},
	{193, 0, 192},
	{202, 0, 198},
	{210, 0, 209},
	{221, 0, 218},
	{208, 0, 213},
	{204, 0, 210},
	{195, 0, 212},
	{184, 0, 203},
	{178, 0, 206},
	{169, 0, 200},
	{157, 0, 194},
	{153, 0, 197},
	{144, 0, 191},
	{134, 0, 190},
	{127, 0, 187},
	{117, 0, 180},
	{108, 0, 181},
	{100, 0, 174},
	{91, 0, 174},
	{83, 0, 170},
	{75, 0, 165},
	{66, 0, 164},
	{56, 0, 159},
	{50, 0, 162},
	{40, 0, 156},
	{33, 0, 151},
	{25, 0, 150},
	{17, 0, 147},
	{7, 0, 143},
	{0, 0, 141},
	{0, 0, 140},
	{0, 6, 145},
	{0, 14, 145},
	{0, 22, 146},
	{0, 28, 149},
	{0, 39, 154},
	{0, 45, 154},
	{0, 56, 157},
	{0, 64, 159},
	{0, 72, 167},
	{0, 82, 167},
	{0, 89, 170},
	{0, 97, 172},
	{0, 106, 174},
	{0, 115, 178},
	{0, 123, 181},
	{0, 131, 184},
	{0, 139, 185},
	{0, 148, 189},
	{0, 154, 193},
	{0, 163, 197},
	{0, 173, 197},
	{0, 179, 199},
	{0, 190, 203},
	{0, 197, 206},
	{0, 205, 207},
	{0, 214, 211},
	{0, 222, 213},
	{0, 217, 206},
	{0, 212, 200},
	{0, 205, 188},
	{0, 200, 181},
	{0, 196, 171},
	{0, 190, 163},
	{0, 185, 155},
	{0, 179, 147},
	{0, 173, 139},
	{0, 168, 131},
	{0, 162, 125},
	{0, 156, 115},
	{0, 149, 108},
	{0, 145, 95},
	{0, 142, 89},
	{0, 134, 81},
	{0, 129, 74},
	{0, 126, 64},
	{0, 119, 59},
	{0, 115, 48},
	{0, 109, 39},
	{0, 101, 34},
	{0, 97, 21},
	{0, 92, 15},
	{0, 84, 7},
	{0, 80, 0},
	{0, 73, 0},
	{0, 79, 0},
	{5, 84, 0},
	{14, 89, 0},
	{19, 96, 0},
	{28, 99, 0},
	{36, 107, 0},
	{45, 114, 0},
	{49, 116, 0},
	{60, 121, 0},
	{69, 126, 0},
	{74, 132, 0},
	{82, 136, 0},
	{94, 140, 0},
	{99, 148, 0},
	{105, 151, 0},
	{114, 157, 0},
	{123, 160, 0},
	{128, 167, 0},
	{134, 171, 0},
	{145, 178, 0},
	{153, 184, 0},
	{159, 188, 0},
	{168, 194, 0},
	{177, 197, 0},
	{184, 202, 0},
	{189, 208, 0},
	{202, 212, 0},
	{205, 219, 0},
	{215, 225, 0},
	{211, 217, 0},
	{207, 207, 0},
	{205, 202, 0},
	{200, 193, 0},
	{196, 183, 0},
	{192, 175, 0},
	{188, 169, 0},
	{187, 160, 0},
	{179, 152, 0},
	{179, 143, 0},
	{176, 137, 0},
	{169, 131, 0},
	{165, 122, 0},
	{163, 113, 0},
	{158, 107, 0},
	{156, 102, 0},
	{153, 94, 0},
	{148, 83, 0},
	{144, 75, 0},
	{142, 68, 0},
	{139, 60, 0},
	{134, 53, 0},
	{131, 42, 0},
	{130, 33, 0},
	{124, 27, 0},
	{118, 21, 0},
	{116, 12, 0},
	{113, 6, 0},
	{109, 0, 0},
	{112, 0, 0},
	{117, 0, 0},
	{119, 2, 0},
	{123, 4, 0},
	{126, 5, 0},
	{129, 6, 2},
	{136, 6, 5},
	{136, 9, 5},
	{143, 9, 9},
	{143, 14, 6},
	{145, 17, 6},
	{149, 17, 10},
	{153, 19, 11},
	{156, 21, 15},
	{158, 21, 14},
	{159, 23, 18},
	{165, 25, 17},
	{173, 23, 21},
	{171, 28, 23},
	{176, 29, 23},
	{180, 31, 25},
	{184, 32, 29},
	{185, 37, 24},
	{188, 37, 27},
	{193, 37, 33},
	{196, 40, 31},
	{200, 42, 32},
	{200, 45, 34},
	{203, 50, 39},
	{204, 57, 51},
	{206, 63, 55},
	{209, 70, 65},
	{208, 78, 68},
	{209, 86, 74},
	{211, 90, 88},
	{214, 98, 94},
	{217, 103, 99},
	{218, 112, 103},
	{217, 117, 115},
	{219, 126, 121},
	{222, 130, 126},
	{223, 138, 133},
	{222, 145, 139},
	{224, 151, 147},
	{227, 157, 151},
	{228, 165, 159},
	{227, 172, 165},
	{228, 179, 175},
	{232, 185, 176},
	{233, 193, 186},
	{231, 200, 192},
	{233, 208, 198},
	{235, 214, 205},
	{234, 223, 211},
	{236, 228, 219},
	{242, 233, 229},
	{242, 240, 234},
	{242, 240, 234},
	{242, 240, 234},
	{242, 240, 234},
	{242, 240, 234},
	{242, 240, 234},
	{242, 240, 234},
	{242, 240, 234},
	{242, 240, 234},
	{242, 240, 234},
	{242, 240, 234},
	{242, 240, 234},
	{242, 240, 234},
	{242, 240, 234},
	{242, 240, 234},
	{242, 240, 234},
	{242, 240, 234},
	{242, 240, 234},
	{242, 240, 234},
	{242, 240, 234},
	{242, 240, 234},
	{242, 240, 234},
	{242, 240, 234},
	{242, 240, 234},
	{242, 240, 234},
	{242, 240, 234},
	{242, 240, 234},
	{242, 240, 234},
	{242, 240, 234},
	{242, 240, 234},
	{242, 240, 234},
	{242, 240, 234},
	{242, 240, 234}
};
